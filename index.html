<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Aurum IQ â€¢ Live Gold Dashboard</title>
  <meta name="theme-color" content="#0b0c10" />
  <meta name="description" content="Luxury live gold price dashboard with IQD conversion, karats, margin tools, expectation calculator, tax solver, advanced chart, and pro calculator." />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icon-192.png" />
  <link rel="apple-touch-icon" href="assets/icon-192.png" />
  <link rel="stylesheet" href="style.css" />
  <!-- Chart.js + Zoom Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <!-- Supabase (optional, requires anon key in config.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script defer src="config.js"></script>
  <script defer src="logic.js"></script>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="mark" aria-hidden="true">
          <img src="assets/icon.svg" alt="" />
        </div>
        <div class="brandText">
          <div class="brandName">Aurum IQ</div>
          <div class="brandTag">Luxury live gold â€¢ USD â†” IQD â€¢ Smart margin tools</div>
        </div>
      </div>

      <div class="statusRow">
        <div class="clockBox">
          <div class="miniLabel">Local Time</div>
          <div class="clock" id="clock">--:--:--</div>
        </div>

        <div class="netBox" id="netBox" title="Connection Status">
          <div class="miniLabel">Connection</div>
          <div class="netLine">
            <span class="dot" id="netDot" aria-hidden="true"></span>
            <span class="netText" id="netText">Checkingâ€¦</span>
            <span class="sig" id="netSig" aria-hidden="true">â–‚â–ƒâ–…â–‡</span>
          </div>
        </div>

        <button class="pill installBtn" id="installBtn" type="button" title="Install as app">
          <span class="pillIcon">â¬‡</span>
          <span>Install</span>
        </button>
      </div>
    </header>

    <main class="grid">
      <!-- HERO: Live ounce -->
      <section class="card hero">
        <div class="cardHead">
          <div>
            <div class="title">Live Gold (XAU) â€” Ounce</div>
            <div class="subtitle">Updates only when price changes â€¢ Noise filtered â‰¥ $0.10</div>
          </div>
          <div class="rightMeta">
            <div class="miniLabel">Last Updated</div>
            <div class="updated" id="lastUpdated">â€”</div>
          </div>
        </div>

        <div class="heroBody">
          <div class="heroPrice">
            <div class="bigPrice" id="livePrice">â€”</div>
            <div class="deltaBox" id="liveDelta">
              <span class="deltaArrow" id="liveArrow">â€”</span>
              <span class="deltaAmt" id="liveDeltaAmt">â€”</span>
              <span class="deltaPct" id="liveDeltaPct">â€”</span>
            </div>
          </div>

          <div class="heroControls">
            <div class="inputGroup">
              <label for="usdIqd" class="label">
                USD to IQD <span class="hint">(leave empty = USD)</span>
              </label>
              <input id="usdIqd" inputmode="decimal" autocomplete="off" placeholder="e.g., 1500" />
              <div class="tinyHelp">All karat outputs auto-convert when this field is filled.</div>
            </div>

            <div class="seg">
              <div class="segLabel">Output Unit</div>
              <div class="segBtns" role="group" aria-label="Unit choice">
                <button class="segBtn active" id="unitLiveMithqal" type="button">Mithqal (5g)</button>
                <button class="segBtn" id="unitLiveGram" type="button">Gram</button>
              </div>
            </div>

            <div class="chipRow" aria-label="Quick metrics">
              <div class="chip">
                <div class="miniLabel">24K / unit</div>
                <div class="chipVal" id="k24Price">â€”</div>
                <div class="chipDelta" id="k24Delta">â€”</div>
              </div>
              <div class="chip">
                <div class="miniLabel">22K / unit</div>
                <div class="chipVal" id="k22Price">â€”</div>
                <div class="chipDelta" id="k22Delta">â€”</div>
              </div>
              <div class="chip">
                <div class="miniLabel">21K / unit</div>
                <div class="chipVal" id="k21Price">â€”</div>
                <div class="chipDelta" id="k21Delta">â€”</div>
              </div>
              <div class="chip">
                <div class="miniLabel">18K / unit</div>
                <div class="chipVal" id="k18Price">â€”</div>
                <div class="chipDelta" id="k18Delta">â€”</div>
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="marginRow">
          <div class="marginLeft">
            <div class="titleSm">IQD Margin Slider (Karats only)</div>
            <div class="subtitleSm">Applies only when USDâ†’IQD is filled. Step: 1,000 IQD â€¢ Range: 0â€“70,000</div>
          </div>

          <div class="marginRight">
            <div class="marginValue">
              <span class="miniLabel">Margin</span>
              <span class="marginNum" id="marginVal">0 IQD</span>
            </div>
            <input id="marginSlider" type="range" min="0" max="70000" step="1000" value="0" />
          </div>
        </div>

        <div class="note">
          The â–²/â–¼ movement is linked only to the live ounce price â€” it does not reset to neutral; it stays red/green based on the latest change.
        </div>
      </section>

      <!-- CHART -->
      <section class="card chartCard">
        <div class="cardHead">
          <div>
            <div class="title">Gold Price Chart</div>
            <div class="subtitle">Scroll to zoom â€¢ Drag to pan â€¢ Crosshair ruler â€¢ Timeframes</div>
          </div>
          <div class="tfRow" role="group" aria-label="Chart timeframes">
            <button class="tfBtn active" data-tf="24h" type="button">24h</button>
            <button class="tfBtn" data-tf="7d" type="button">7D</button>
            <button class="tfBtn" data-tf="1m" type="button">Months</button>
            <button class="tfBtn" data-tf="1y" type="button">Years</button>
          </div>
        </div>

        <div class="chartWrap">
          <canvas id="priceChart" aria-label="Gold price chart"></canvas>
          <div class="chartOverlay" id="chartOverlay" aria-hidden="true">
            <div class="overlayBox" id="overlayBox">
              <div class="overlayPrice" id="overlayPrice">â€”</div>
              <div class="overlayTime" id="overlayTime">â€”</div>
            </div>
          </div>
        </div>

        <div class="chartFoot">
          <div class="footLeft">
            <div class="miniLabel">History Source</div>
            <div class="footVal" id="historySource">Local cache</div>
          </div>
          <div class="footRight">
            <button class="pill" id="resetZoomBtn" type="button">
              <span class="pillIcon">â†º</span><span>Reset Zoom</span>
            </button>
            <button class="pill" id="exportBtn" type="button">
              <span class="pillIcon">â¤“</span><span>Export JSON</span>
            </button>
          </div>
        </div>
      </section>

      <!-- EXPECTATION -->
      <section class="card">
        <div class="cardHead">
          <div>
            <div class="title">Expectation Calculator</div>
            <div class="subtitle">Type your expected ounce price â€” instant per unit results</div>
          </div>
        </div>

        <div class="formGrid">
          <div class="inputGroup">
            <label class="label" for="expOunce">Expected Ounce Price</label>
            <input id="expOunce" inputmode="decimal" autocomplete="off" placeholder="e.g., 2450.50" />
          </div>

          <div class="inputGroup">
            <label class="label" for="expUsdIqd">USD to IQD</label>
            <input id="expUsdIqd" inputmode="decimal" autocomplete="off" placeholder="e.g., 1500" />
          </div>

          <div class="inputGroup">
            <div class="label">Karat</div>
            <div class="selectWrap">
              <select id="expKarat">
                <option value="24">24K</option>
                <option value="22">22K</option>
                <option value="21" selected>21K</option>
                <option value="18">18K</option>
              </select>
            </div>
          </div>

          <div class="inputGroup">
            <div class="label">Unit</div>
            <div class="selectWrap">
              <select id="expUnit">
                <option value="mithqal" selected>Mithqal (5g)</option>
                <option value="gram">Gram</option>
              </select>
            </div>
          </div>
        </div>

        <div class="expectResult">
          <div class="bigPrice" id="expResult">â€”</div>
          <div class="deltaMuted" id="expHint">Enter values to see results.</div>
        </div>

        <div class="divider"></div>

        <div class="marginRow">
          <div class="marginLeft">
            <div class="titleSm">Expectation Margin Slider (IQD)</div>
            <div class="subtitleSm">Step: 1,000 IQD â€¢ Range: 0â€“70,000</div>
          </div>
          <div class="marginRight">
            <div class="marginValue">
              <span class="miniLabel">Margin</span>
              <span class="marginNum" id="expMarginVal">0 IQD</span>
            </div>
            <input id="expMarginSlider" type="range" min="0" max="70000" step="1000" value="0" />
          </div>
        </div>
      </section>

      <!-- TAX SOLVER -->
      <section class="card">
        <div class="cardHead">
          <div>
            <div class="title">Tax / Margin Solver (21K)</div>
            <div class="subtitle">Find the margin added locally â€” then auto-sync the slider</div>
          </div>
        </div>

        <div class="formGrid">
          <div class="inputGroup">
            <label class="label" for="solveOunce">Last Ounce Price (USD)</label>
            <input id="solveOunce" inputmode="decimal" autocomplete="off" placeholder="e.g., 2400" />
          </div>

          <div class="inputGroup">
            <label class="label" for="solveUsdIqd">USD to IQD</label>
            <input id="solveUsdIqd" inputmode="decimal" autocomplete="off" placeholder="e.g., 1500" />
          </div>

          <div class="inputGroup">
            <label class="label" for="solveK21">21K Price per Mithqal (IQD)</label>
            <input id="solveK21" inputmode="decimal" autocomplete="off" placeholder="e.g., 505000" />
          </div>
        </div>

        <div class="solveOut">
          <div class="miniLabel">Detected Margin</div>
          <div class="bigPrice" id="solveMargin">â€”</div>
          <div class="deltaMuted" id="solveNote">Will snap the main slider to the nearest 1,000 IQD.</div>
        </div>

        <button class="cta" id="applySolveBtn" type="button">Apply margin to main slider</button>
      </section>

      <!-- CALCULATOR -->
      <section class="card calcCard">
        <div class="cardHead">
          <div>
            <div class="title">Advanced Calculator</div>
            <div class="subtitle">Samsung-like layout â€¢ Full functions â€¢ History toggle</div>
          </div>
          <div class="calcActions">
            <button class="pill" id="toggleHistoryBtn" type="button">
              <span class="pillIcon">â˜°</span><span>History</span>
            </button>
            <button class="pill" id="clearHistoryBtn" type="button">
              <span class="pillIcon">ðŸ—‘</span><span>Clear</span>
            </button>
          </div>
        </div>

        <div class="calcShell">
          <div class="calcDisplay">
            <div class="calcExpr" id="calcExpr"> </div>
            <div class="calcOut" id="calcOut">0</div>
          </div>

          <div class="calcBody">
            <div class="calcKeys" id="calcKeys" aria-label="Calculator keys"></div>
            <aside class="calcHistory hidden" id="calcHistory">
              <div class="historyTitle">History</div>
              <div class="historyList" id="historyList"></div>
            </aside>
          </div>
        </div>
      </section>

      <!-- FOOTER -->
      <section class="card footerCard">
        <div class="footerGrid">
          <div>
            <div class="title">Install on Android</div>
            <div class="subtitle">
              This project is a PWA (installable web app). Tap <b>Install</b> on top (or browser menu â†’ <b>Add to Home screen</b>).
              For a true APK wrapper, use an Android Trusted Web Activity tool (Bubblewrap) with this PWA.
            </div>
          </div>

          <div class="footerRight">
            <div class="miniLabel">API</div>
            <div class="footVal">api.gold-api.com /price/XAU</div>
            <div class="miniLabel" style="margin-top:10px">Persistence</div>
            <div class="footVal">Supabase optional (configure in config.js)</div>
          </div>
        </div>
      </section>
    </main>
  </div>
</body>
</html>
